import{p as g}from"./performance-DDj-MScj.js";function _(r){const e={articles:new Map,titleIndex:new Map,contentIndex:new Map,categoryIndex:new Map,sourceIndex:new Map,lastUpdated:Date.now()};return r.forEach((s,t)=>{const n=`${s.link}-${t}`;e.articles.set(n,s),m(s.title).forEach(a=>{e.titleIndex.has(a)||e.titleIndex.set(a,[]),e.titleIndex.get(a).push(n)}),s.description&&m(s.description).forEach(l=>{e.contentIndex.has(l)||e.contentIndex.set(l,[]),e.contentIndex.get(l).push(n)}),s.categories&&s.categories.forEach(a=>{m(a).forEach(c=>{e.categoryIndex.has(c)||e.categoryIndex.set(c,[]),e.categoryIndex.get(c).push(n)})}),m(s.sourceTitle).forEach(a=>{e.sourceIndex.has(a)||e.sourceIndex.set(a,[]),e.sourceIndex.get(a).push(n)})}),e}function m(r){return r.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>2)}function U(r,e,s={}){const{includeTitle:t=!0,includeContent:n=!0,includeCategories:o=!0,includeSource:i=!0,fuzzyThreshold:a=.6}=s;if(!e.trim())return[];const l=m(e),c=new Map;l.forEach(h=>{t&&d(r.titleIndex,h,a,c,"title",3),n&&d(r.contentIndex,h,a,c,"content",1),o&&d(r.categoryIndex,h,a,c,"category",2),i&&d(r.sourceIndex,h,a,c,"source",1.5)});const u=[];return c.forEach((h,f)=>{const y=r.articles.get(f);y&&u.push({article:y,score:h.score,matchedFields:Array.from(h.matchedFields)})}),u.sort((h,f)=>f.score-h.score)}function d(r,e,s,t,n,o){r.forEach((i,a)=>{const l=I(e,a);if(l>=s){const c=l*o;i.forEach(u=>{t.has(u)||t.set(u,{score:0,matchedFields:new Set});const h=t.get(u);h.score+=c,h.matchedFields.add(n)})}})}function I(r,e){if(r===e)return 1;if(r.includes(e)||e.includes(r))return .9;const s=Math.max(r.length,e.length);return s===0?1:1-$(r,e)/s}function $(r,e){const s=Array(e.length+1).fill(null).map(()=>Array(r.length+1).fill(null));for(let t=0;t<=r.length;t++)s[0][t]=t;for(let t=0;t<=e.length;t++)s[t][0]=t;for(let t=1;t<=e.length;t++)for(let n=1;n<=r.length;n++){const o=r[n-1]===e[t-1]?0:1;s[t][n]=Math.min(s[t][n-1]+1,s[t-1][n]+1,s[t-1][n-1]+o)}return s[e.length][r.length]}function N(r,e){if(!e.trim())return r;const s=e.trim().split(/\s+/);let t=r;return s.forEach(n=>{const o=M(n),i=new RegExp(`(${o})`,"gi");t=t.replace(i,"<mark>$1</mark>")}),t}function M(r){return r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const A="https://api.open-meteo.com/v1/forecast",T="https://geocoding-api.open-meteo.com/v1/search";async function K(r){const e=new URLSearchParams({name:r,count:"1",language:"en",format:"json"}),s=await fetch(`${T}?${e.toString()}`);if(!s.ok)throw new Error("Failed to fetch geocoding data");const t=await s.json();if(!t.results||t.results.length===0)return null;const n=t.results[0];return{latitude:n.latitude,longitude:n.longitude,name:n.name}}async function O(r,e){const s=new URLSearchParams({latitude:r.toString(),longitude:e.toString(),current_weather:"true"}),t=await fetch(`${A}?${s.toString()}`);if(!t.ok)throw new Error("Failed to fetch weather data");const n=await t.json();if(!n.current_weather)throw new Error("Invalid weather data received");return{temperature:n.current_weather.temperature,weatherCode:n.current_weather.weathercode,isDay:n.current_weather.is_day===1}}const w={log:r=>{}},E={maxSize:500,maxAge:24*60*60*1e3,memoryLimit:50,autoCleanupInterval:5*60*1e3};class k{constructor(e={}){this.options={...E,...e},this.cache=new Map,this.stats={hits:0,misses:0,evictions:0},this.cleanupInterval=null,this.options.autoCleanupInterval>0&&this.startAutoCleanup()}getKey(e){return`${e.link}|${e.sourceTitle}`}get(e,s){let t;if(typeof e=="string"&&s)t=`${e}|${s}`;else if(typeof e=="object")t=this.getKey(e);else throw new Error("Invalid arguments to get()");const n=this.cache.get(t);return n?(this.cache.delete(t),this.cache.set(t,{article:n.article,timestamp:n.timestamp}),this.stats.hits++,n.article):(this.stats.misses++,null)}set(e){const s=this.getKey(e);this.cache.delete(s),this.cache.set(s,{article:e,timestamp:Date.now()}),this.enforceConstraints()}setMany(e){e.forEach(s=>this.set(s))}has(e,s){let t;if(typeof e=="string"&&s)t=`${e}|${s}`;else if(typeof e=="object")t=this.getKey(e);else throw new Error("Invalid arguments to has()");return this.cache.has(t)}delete(e,s){let t;if(typeof e=="string"&&s)t=`${e}|${s}`;else if(typeof e=="object")t=this.getKey(e);else throw new Error("Invalid arguments to delete()");return this.cache.delete(t)}clear(){this.cache.clear()}size(){return this.cache.size}getAll(){return Array.from(this.cache.values()).map(e=>e.article)}getStats(){const e=Date.now();let s=0,t=e,n=0;this.cache.forEach(({timestamp:u})=>{s+=e-u,u<t&&(t=u),u>n&&(n=u)});const o=this.cache.size,i=o>0?s/o:0,a=o>0?e-t:0,l=o>0?e-n:0;let c=null;return"memory"in performance&&(c=Math.round(performance.memory.usedJSHeapSize/(1024*1024))),{hits:this.stats.hits,misses:this.stats.misses,hitRate:this.stats.hits+this.stats.misses>0?this.stats.hits/(this.stats.hits+this.stats.misses):0,size:o,maxSize:this.options.maxSize,evictions:this.stats.evictions,oldestItemAge:a,newestItemAge:l,averageAge:i,memoryUsage:c}}enforceConstraints(){this.enforceMaxSize(),this.enforceMaxAge(),this.enforceMemoryLimit()}enforceMaxSize(){if(this.cache.size<=this.options.maxSize)return;const e=this.cache.size-this.options.maxSize;if(e<=0)return;const s=Array.from(this.cache.entries()).sort((t,n)=>t[1].timestamp-n[1].timestamp);for(let t=0;t<e;t++)t<s.length&&(this.cache.delete(s[t][0]),this.stats.evictions++)}enforceMaxAge(){if(this.options.maxAge<=0)return;const e=Date.now();this.cache.forEach((s,t)=>{e-s.timestamp>this.options.maxAge&&(this.cache.delete(t),this.stats.evictions++)})}enforceMemoryLimit(){if(this.options.memoryLimit<=0||!("memory"in performance))return;const s=performance.memory.usedJSHeapSize/(1024*1024);if(s<this.options.memoryLimit)return;const t=Math.max(1,Math.ceil(this.cache.size*.1)),n=Array.from(this.cache.entries()).sort((o,i)=>o[1].timestamp-i[1].timestamp);for(let o=0;o<t&&o<n.length;o++)this.cache.delete(n[o][0]),this.stats.evictions++;w.log(`Evicted ${t} articles from cache due to memory limit (${s.toFixed(2)}MB used)`)}startAutoCleanup(){this.cleanupInterval===null&&(this.cleanupInterval=window.setInterval(()=>{this.cleanup()},this.options.autoCleanupInterval),w.log(`Started automatic cache cleanup every ${this.options.autoCleanupInterval/1e3} seconds`))}stopAutoCleanup(){this.cleanupInterval!==null&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}cleanup(){this.cache.size,this.enforceMaxAge(),this.enforceMemoryLimit(),this.cache.size}resetStats(){this.stats={hits:0,misses:0,evictions:0}}}const x=new k,C="https://api.rss2json.com/v1/api.json?rss_url=",D=15*60*1e3;function P(r){return new DOMParser().parseFromString(r,"text/html").body.textContent||""}function S(r){return`feed:${r}`}async function V(r){const e=z(r);if(e.length>0)return g.log(`Using ${e.length} cached articles for feed: ${r}`),{title:e[0].sourceTitle,articles:e};g.log(`Fetching feed from API: ${r}`);const s=`${C}${encodeURIComponent(r)}`,t=await fetch(s);if(!t.ok)throw new Error(`Failed to fetch from rss2json API: ${t.statusText}`);const n=await t.json();if(n.status!=="ok")throw new Error(`The rss2json API could not process the feed from ${r}. Message: ${n.message}`);const o=n.feed.title??"Untitled Feed",i=n.items.map(a=>{const l=a.pubDate,c=l?new Date(l):new Date;return{title:a.title??"No Title",link:a.link??"#",pubDate:c,description:a.description?P(a.description).substring(0,200):"",imageUrl:a.thumbnail||void 0,author:a.author||void 0,categories:a.categories||[],sourceTitle:o}}).filter(a=>a.title!=="No Title"&&a.link!=="#");return i.length>0&&F(r,i),{title:o,articles:i}}function z(r){const e=S(r),s=localStorage.getItem(e);if(!s)return[];try{const{timestamp:t,articleKeys:n}=JSON.parse(s);if(Date.now()-t>D)return localStorage.removeItem(e),[];const o=[];for(const i of n){const[a,l]=i.split("|"),c=x.get(a,l);c&&o.push(c)}return o.length>=n.length/2?o:(localStorage.removeItem(e),[])}catch(t){return console.error("Error retrieving cached articles:",t),localStorage.removeItem(e),[]}}function F(r,e){x.setMany(e);const s=S(r),t=e.map(o=>`${o.link}|${o.sourceTitle}`),n={timestamp:Date.now(),articleKeys:t};try{localStorage.setItem(s,JSON.stringify(n)),g.log(`Cached ${e.length} articles for feed: ${r}`)}catch(o){console.error("Error caching articles:",o)}}function L(r){const s=new DOMParser().parseFromString(r,"application/xml");return Array.from(s.querySelectorAll('outline[type="rss"][xmlUrl]')).map(n=>n.getAttribute("xmlUrl")).filter(n=>!!n)}const p=[{id:"dark-default",name:"Dark Default",description:"Classic dark theme with teal accents",category:"dark",theme:{id:"dark-default",name:"Dark Default",colors:{primary:"20 184 166",secondary:"45 55 72",accent:"20 184 166",background:"26 32 44",surface:"45 55 72",text:"247 250 252",textSecondary:"160 174 192",border:"75 85 99",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"light-clean",name:"Light Clean",description:"Clean light theme with blue accents",category:"light",theme:{id:"light-clean",name:"Light Clean",colors:{primary:"59 130 246",secondary:"229 231 235",accent:"59 130 246",background:"255 255 255",surface:"249 250 251",text:"17 24 39",textSecondary:"107 114 128",border:"209 213 219",success:"34 197 94",warning:"251 191 36",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"purple-vibrant",name:"Purple Vibrant",description:"Vibrant dark theme with purple accents",category:"colorful",theme:{id:"purple-vibrant",name:"Purple Vibrant",colors:{primary:"168 85 247",secondary:"55 48 163",accent:"168 85 247",background:"30 27 75",surface:"55 48 163",text:"255 255 255",textSecondary:"196 181 253",border:"124 58 237",success:"34 197 94",warning:"251 191 36",error:"248 113 113"},layout:"comfortable",density:"medium",borderRadius:"large",shadows:!0,animations:!0}},{id:"minimal-mono",name:"Minimal Mono",description:"Minimalist monochrome theme",category:"minimal",theme:{id:"minimal-mono",name:"Minimal Mono",colors:{primary:"75 85 99",secondary:"229 231 235",accent:"17 24 39",background:"255 255 255",surface:"255 255 255",text:"17 24 39",textSecondary:"107 114 128",border:"229 231 235",success:"75 85 99",warning:"75 85 99",error:"75 85 99"},layout:"compact",density:"low",borderRadius:"none",shadows:!1,animations:!1}},{id:"ocean-blue",name:"Ocean Blue",description:"Deep ocean theme with blue gradients",category:"colorful",theme:{id:"ocean-blue",name:"Ocean Blue",colors:{primary:"59 130 246",secondary:"30 58 138",accent:"147 197 253",background:"15 23 42",surface:"30 41 59",text:"248 250 252",textSecondary:"148 163 184",border:"71 85 105",success:"6 182 212",warning:"251 191 36",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},{id:"forest-green",name:"Forest Green",description:"Natural forest theme with green tones",category:"colorful",theme:{id:"forest-green",name:"Forest Green",colors:{primary:"34 197 94",secondary:"22 101 52",accent:"74 222 128",background:"20 83 45",surface:"22 101 52",text:"240 253 244",textSecondary:"134 239 172",border:"34 197 94",success:"74 222 128",warning:"251 191 36",error:"248 113 113"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}}],H={currentTheme:p[0].theme,customThemes:[],autoDetectSystemTheme:!0,systemThemeOverride:null,themeTransitions:!0},v=r=>{const e=["id","name","colors","layout","density","borderRadius"],s=["primary","secondary","accent","background","surface","text","textSecondary","border","success","warning","error"];for(const t of e)if(!(t in r))return console.warn(`Theme validation failed: missing field "${t}"`),!1;if(r.colors){for(const t of s)if(!(t in r.colors))return console.warn(`Theme validation failed: missing color "${t}"`),!1}if(r.colors){for(const[t,n]of Object.entries(r.colors))if(!R(n))return console.warn(`Theme validation failed: invalid RGB format for color "${t}": "${n}"`),!1}return!0},R=r=>/^\d{1,3}\s+\d{1,3}\s+\d{1,3}$/.test(r)?r.split(/\s+/).map(Number).every(t=>t>=0&&t<=255):!1,J=(r,e="1.0")=>{try{if(typeof r=="string")return b(r,"Migrated Theme");if(v(r))return r;if(r.colors?.accent||r.accent){const s=r.colors?.accent||r.accent;return b(s,r.name||"Migrated Theme")}return null}catch(s){return console.error("Theme migration failed:",s),null}},b=(r,e)=>{const s=r.split(/\s+/).map(Number),[t,n,o]=s,i=t*.299+n*.587+o*.114<128;return{id:`custom-${Date.now()}`,name:e,colors:{primary:r,secondary:i?"45 55 72":"229 231 235",accent:r,background:i?"26 32 44":"255 255 255",surface:i?"45 55 72":"249 250 251",text:i?"247 250 252":"17 24 39",textSecondary:i?"160 174 192":"107 114 128",border:i?"75 85 99":"209 213 219",success:"16 185 129",warning:"245 158 11",error:"239 68 68"},layout:"comfortable",density:"medium",borderRadius:"medium",shadows:!0,animations:!0}},W=r=>{const e=document.documentElement;Object.entries(r.colors).forEach(([a,l])=>{e.style.setProperty(`--color-${a}`,l)});const t={compact:{padding:"0.5rem",gap:"0.5rem"},comfortable:{padding:"1rem",gap:"1rem"},spacious:{padding:"1.5rem",gap:"1.5rem"}}[r.layout];e.style.setProperty("--layout-padding",t.padding),e.style.setProperty("--layout-gap",t.gap);const o={low:{fontSize:"0.875rem",lineHeight:"1.25rem"},medium:{fontSize:"1rem",lineHeight:"1.5rem"},high:{fontSize:"1.125rem",lineHeight:"1.75rem"}}[r.density];e.style.setProperty("--density-font-size",o.fontSize),e.style.setProperty("--density-line-height",o.lineHeight);const i={none:"0",small:"0.25rem",medium:"0.5rem",large:"1rem"};e.style.setProperty("--border-radius",i[r.borderRadius]),e.style.setProperty("--shadows-enabled",r.shadows?"1":"0"),e.style.setProperty("--animations-enabled",r.animations?"1":"0"),e.style.setProperty("--transition-duration",r.animations?"0.2s":"0s")},B=()=>typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"dark",G=r=>{const e=p.filter(s=>s.category===r||r==="dark"&&s.category==="colorful");return e.length>0?e[0].theme:p[0].theme},q=r=>JSON.stringify(r,null,2),Q=r=>{try{const e=JSON.parse(r);return v(e)?e:null}catch(e){return console.error("Failed to import theme:",e),null}};export{x as a,_ as b,O as c,H as d,B as e,G as f,K as g,N as h,W as i,p as j,q as k,Q as l,J as m,V as n,L as p,U as s,v};
